// –õ–æ–∫–∞–ª—å–Ω—ã–π AI –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API)
let currentFile = null;

// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
const SUPPORTED_FORMATS = {
    'text/plain': 'TXT',
    'application/pdf': 'PDF',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'DOCX',
    'image/jpeg': 'JPEG',
    'image/jpg': 'JPG',
    'image/png': 'PNG',
    'image/gif': 'GIF'
};

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
document.getElementById('fileInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    currentFile = file;
    const fileType = SUPPORTED_FORMATS[file.type] || file.name.split('.').pop().toUpperCase();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
    document.getElementById('fileInfo').innerHTML = 
        `üìÑ <strong>${file.name}</strong> (${fileType}, ${formatFileSize(file.size)})`;
    document.getElementById('fileInfo').style.display = 'block';
    
    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
    document.getElementById('textInput').value = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
    document.getElementById('textInput').placeholder = `–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é ${fileType} —Ñ–∞–π–ª...`;
    
    try {
        let text = '';
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
        if (file.type === 'text/plain') {
            // TXT —Ñ–∞–π–ª
            text = await readTextFile(file);
        }
        else if (file.type === 'application/pdf') {
            // PDF —Ñ–∞–π–ª
            text = await extractTextFromPDF(file);
        }
        else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
            // DOCX —Ñ–∞–π–ª
            text = await extractTextFromDOCX(file);
        }
        else if (file.type.startsWith('image/')) {
            // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            text = await extractTextFromImage(file);
        }
        else {
            // –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
            text = `[–§–∞–π–ª: ${file.name}, –¢–∏–ø: ${fileType}]\n` +
                   `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é.`;
        }
        
        // –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ
        document.getElementById('textInput').value = text;
        document.getElementById('textInput').placeholder = "–¢–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω...";
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:', error);
        document.getElementById('textInput').value = 
            `‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ ${file.name}\n` +
            `–¢–∏–ø: ${file.type}\n` +
            `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é.`;
    }
});

// –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
function readTextFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = reject;
        reader.readAsText(file);
    });
}

// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
function extractTextFromPDF(file) {
    return new Promise((resolve) => {
        // –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF –Ω—É–∂–Ω—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
        // –ó–¥–µ—Å—å —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
        const reader = new FileReader();
        reader.onload = function(e) {
            resolve(`üìë PDF —Ñ–∞–π–ª: ${file.name}\n\n` +
                   `–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF —Ñ–∞–π–ª–æ–≤ –Ω—É–∂–Ω–æ:\n` +
                   `1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É\n` +
                   `2. –ò–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PDF –≤ —Ç–µ–∫—Å—Ç –æ–Ω–ª–∞–π–Ω\n` +
                   `3. –ò–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ PDF –≤—Ä—É—á–Ω—É—é\n\n` +
                   `–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å PDF –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç (Ctrl+A, Ctrl+C).`);
        };
        reader.readAsDataURL(file);
    });
}

// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ DOCX (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
function extractTextFromDOCX(file) {
    return new Promise((resolve) => {
        // DOCX - —ç—Ç–æ ZIP –∞—Ä—Ö–∏–≤ —Å XML —Ñ–∞–π–ª–∞–º–∏
        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
        const reader = new FileReader();
        reader.onload = function(e) {
            resolve(`üìù DOCX —Ñ–∞–π–ª: ${file.name}\n\n` +
                   `–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ DOCX —Ñ–∞–π–ª–æ–≤ –Ω—É–∂–Ω–æ:\n` +
                   `1. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ TXT –æ–Ω–ª–∞–π–Ω\n` +
                   `2. –û—Ç–∫—Ä—ã—Ç—å –≤ Google Docs –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç\n` +
                   `3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏\n\n` +
                   `–°–æ–≤–µ—Ç: –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ Word –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç.`);
        };
        reader.readAsArrayBuffer(file);
    });
}

// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
function extractTextFromImage(file) {
    return new Promise((resolve) => {
        // –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ OCR –Ω—É–∂–Ω—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (Tesseract.js)
        // –ó–¥–µ—Å—å —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
        resolve(`üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${file.name}\n\n` +
               `–î–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω—É–∂–Ω–æ:\n` +
               `1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OCR —Å–µ—Ä–≤–∏—Å—ã (Google Vision, Tesseract)\n` +
               `2. –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –≤ Google Keep/Drive –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è\n` +
               `3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å OCR\n\n` +
               `–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: Google –§–æ—Ç–æ ‚Üí "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"`);
    });
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞
async function createSummary() {
    const text = document.getElementById('textInput').value.trim();
    
    if (!text) {
        alert('‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    document.getElementById('loading').style.display = 'block';
    document.getElementById('result').style.display = 'none';
    
    // –ò–º–∏—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É AI
    setTimeout(() => {
        const summary = generateLocalSummary(text, currentFile);
        
        document.getElementById('summaryText').textContent = summary;
        document.getElementById('result').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
        
    }, 1000);
}

// –õ–æ–∫–∞–ª—å–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
function generateLocalSummary(text, file = null) {
    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
    const words = text.split(/\s+/).filter(w => w.length > 2);
    const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim().length > 0);
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
    let fileInfo = '';
    if (file) {
        fileInfo = `\n**–§–∞–π–ª:** ${file.name} (${formatFileSize(file.size)})`;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ
    const isErrorText = text.includes('‚ùå –û—à–∏–±–∫–∞') || 
                        text.includes('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞') || 
                        text.includes('—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç');
    
    if (isErrorText) {
        return `## ‚ö†Ô∏è –§–ê–ô–õ –ó–ê–ì–†–£–ñ–ï–ù, –ù–û –ù–£–ñ–ù–ê –†–£–ß–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê
        
${text}

## üéØ –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:

### –î–ª—è PDF —Ñ–∞–π–ª–æ–≤:
1. –û—Ç–∫—Ä–æ–π—Ç–µ PDF –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ Adobe Reader
2. –í—ã–¥–µ–ª–∏—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç (Ctrl+A)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ (Ctrl+C)
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤—ã—à–µ (Ctrl+V)

### –î–ª—è DOCX —Ñ–∞–π–ª–æ–≤:
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ Microsoft Word –∏–ª–∏ Google Docs
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤—ã—à–µ

### –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –≤ **Google –î–∏—Å–∫**
2. –ü—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí "–û—Ç–∫—Ä—ã—Ç—å —Å –ø–æ–º–æ—â—å—é" ‚Üí "Google –î–æ–∫—É–º–µ–Ω—Ç—ã"
3. –¢–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–Ω–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã
‚Ä¢ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
‚Ä¢ –ü–µ—Ä–µ–ø–µ—á–∞—Ç–∞–π—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã`;
    }
    
    // –ù–∞—Ö–æ–¥–∏–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    const wordFrequency = {};
    words.forEach(word => {
        const lowerWord = word.toLowerCase();
        wordFrequency[lowerWord] = (wordFrequency[lowerWord] || 0) + 1;
    });
    
    // –¢–æ–ø-—Å–ª–æ–≤
    const topWords = Object.entries(wordFrequency)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 8)
        .map(([word]) => word);
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    const stats = {
        chars: text.length,
        words: words.length,
        sentences: sentences.length,
        paragraphs: paragraphs.length,
        topWords: topWords
    };
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Å–ø–µ–∫—Ç
    return `## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –¢–ï–ö–°–¢–ê:${fileInfo}
‚Ä¢ –°–∏–º–≤–æ–ª–æ–≤: ${stats.chars}
‚Ä¢ –°–ª–æ–≤: ${stats.words}
‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: ${stats.sentences}
‚Ä¢ –ê–±–∑–∞—Ü–µ–≤: ${stats.paragraphs}
‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: ${stats.topWords.join(', ')}

## üîç –ö–õ–Æ–ß–ï–í–´–ï –í–û–ü–†–û–°–´:

1. **–û —á–µ–º —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª?**
   - –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã: ${stats.topWords.slice(0, 3).join(', ')}
   - –û–±—ä–µ–º: ${stats.words > 500 ? '–ë–æ–ª—å—à–æ–π' : stats.words > 100 ? '–°—Ä–µ–¥–Ω–∏–π' : '–ö—Ä–∞—Ç–∫–∏–π'} –º–∞—Ç–µ—Ä–∏–∞–ª

2. **–ö–∞–∫–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?**
   - –°–æ—Å—Ç–æ–∏—Ç –∏–∑ ${stats.paragraphs} –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–æ–≤
   - –°–æ–¥–µ—Ä–∂–∏—Ç ${stats.sentences} –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤/—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π

3. **–ß—Ç–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ?**
   - –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏: ${stats.topWords.slice(0, 5).join(', ')}
   - –û—Å–Ω–æ–≤–Ω–∞—è –º—ã—Å–ª—å –≤ –ø–µ—Ä–≤–æ–º –∞–±–∑–∞—Ü–µ

## üìù –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ô –ö–û–ù–°–ü–ï–ö–¢:

### –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
${generateShortSummary(sentences)}

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:
${generateSections(paragraphs)}

### –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã:
${stats.topWords.map(word => `‚Ä¢ **${word}**`).join('\n')}

### –ß—Ç–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å:
${generateTakeaways(sentences)}

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:

### –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:
1. –ü—Ä–æ—á—Ç–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
2. –í—ã–¥–µ–ª–∏—Ç–µ –≥–ª–∞–≤–Ω—É—é –º—ã—Å–ª—å –∫–∞–∂–¥–æ–≥–æ –∞–±–∑–∞—Ü–∞
3. –°–æ—Å—Ç–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å—ã

### –î–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:
‚Ä¢ –ü–µ—Ä–µ—Å–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏
‚Ä¢ –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É –∏–ª–∏ –º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É
‚Ä¢ –û–±—Å—É–¥–∏—Ç–µ —Å –∫–æ–ª–ª–µ–≥–∞–º–∏

### –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
- –ì–¥–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é?
- –ö–∞–∫–∏–µ –∏–¥–µ–∏ —Å—Ç–æ–∏—Ç —Ä–∞–∑–≤–∏—Ç—å?
- –û —á–µ–º —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–∏–º?

---
üìå *–ö–æ–Ω—Å–ø–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏*
üí° *–î–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ API –∫–ª—é—á*`;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function generateShortSummary(sentences) {
    if (sentences.length === 0) return "–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–¥–µ–ª–∏—Ç—å –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ";
    
    const summarySentences = sentences.slice(0, Math.min(3, sentences.length));
    return summarySentences.map(s => `‚Ä¢ ${s.substring(0, 100).trim()}...`).join('\n');
}

function generateSections(paragraphs) {
    if (paragraphs.length === 0) return "‚Ä¢ –ï–¥–∏–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —á–µ—Ç–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤";
    
    return paragraphs.slice(0, 5).map((para, idx) => {
        const firstLine = para.split('\n')[0]?.substring(0, 60) || para.substring(0, 60);
        return `**–†–∞–∑–¥–µ–ª ${idx + 1}:** ${firstLine}...`;
    }).join('\n');
}

function generateTakeaways(sentences) {
    if (sentences.length < 3) return "‚Ä¢ –í—ã–¥–µ–ª–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º—ã—Å–ª–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ";
    
    const takeaways = [];
    if (sentences.length >= 1) takeaways.push(`1. "${sentences[0].substring(0, 80)}..."`);
    if (sentences.length >= 2) takeaways.push(`2. "${sentences[Math.floor(sentences.length/2)].substring(0, 80)}..."`);
    if (sentences.length >= 3) takeaways.push(`3. "${sentences[sentences.length-1].substring(0, 80)}..."`);
    
    return takeaways.join('\n');
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 –ë';
    const k = 1024;
    const sizes = ['–ë', '–ö–ë', '–ú–ë', '–ì–ë'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

function copyToClipboard() {
    const text = document.getElementById('summaryText').textContent;
    navigator.clipboard.writeText(text)
        .then(() => alert('‚úÖ –ö–æ–Ω—Å–ø–µ–∫—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!'))
        .catch(() => alert('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è'));
}

function downloadSummary() {
    const text = document.getElementById('summaryText').textContent;
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `–∫–æ–Ω—Å–ø–µ–∫—Ç_${new Date().toISOString().slice(0, 10)}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
